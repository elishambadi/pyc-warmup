{% load static %}
<!DOCTYPE html>
<html lang="en">
{% load custom_filters %}
{% load pwa %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- SEO Meta Tags -->
  <title>{% block title %}PYC WarmUp App{% endblock %}</title>
  <meta name="description"
    content="{% block description %}The PYC WarmUp app helps you prepare for PYC events by managing voice notes, songs, and training materials.{% endblock %}">
  <meta name="keywords"
    content="choir, warm-up, voice notes, music, training, song practice, {{ latest_request.title }}">
  <meta property="og:title" content="{% block og_title %}PYC WarmUp App{% endblock %}">
  <meta property="og:description"
    content="{% block og_description %}Manage and upload voice notes for choir rehearsals and events on the PYC WarmUp App.{% endblock %}">
  <meta property="og:image" content="{% static 'images/your-image.jpg' %}">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% block twitter_title %}PYC WarmUp App{% endblock %}">
  <meta name="twitter:description"
    content="{% block twitter_description %}Upload and manage your voice notes for choir events and training with PYC WarmUp App.{% endblock %}">
  <meta name="twitter:image" content="{% static 'images/your-image.jpg' %}">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.ckeditor.com/4.20.0/standard/ckeditor.js"></script>
  {% progressive_web_app_meta %}

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'pyc-purple': '#4B3FA0',
            'pyc-orange': '#F36F21',
            'pyc-green': '#4E9C68',
            'pyc-text': '#4C4C4C',
          }
        }
      }
    }
  </script>

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
  </style>
</head>

<body class="bg-white text-pyc-text flex flex-col min-h-screen" style="background-image: url('{% block background_image %}{% endblock %}');">

  <!-- Navbar -->
  <nav class="sticky top-0 z-50 bg-pyc-purple shadow-md">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between h-16">
        <!-- Brand -->
        <a href="{% url 'song_list' %}" class="flex items-center space-x-2 text-white hover:text-pyc-orange transition-colors">
          <img src="{% static 'images/icons/pyc-logo.jpg' %}" alt="PYC Logo" class="w-8 h-8 rounded-full">
          <span class="font-bold text-lg">PYC WarmUp</span>
        </a>

        <!-- Mobile menu button -->
        <button type="button" class="lg:hidden text-white hover:text-pyc-orange focus:outline-none" 
                onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
          <i class="fas fa-bars text-xl"></i>
        </button>

        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center space-x-6">
          <a href="https://pychoir.parklandssda.org/" target="_blank" 
             class="text-white hover:text-pyc-orange transition-colors">About PYC</a>
          <a href="{% url 'song_list' %}" 
             class="text-white hover:text-pyc-orange transition-colors">Songs</a>
          <a href="{% url 'add_song' %}" 
             class="text-white hover:text-pyc-orange transition-colors">Add Song</a>
             <!-- Display coming soon tooltip for Tailwind when someone hovers over our members -->
          <a href="#" 
             class="text-white hover:text-pyc-orange transition-colors" disabled title="Coming Soon">Our Members</a>

          {% if user.is_authenticated %}
            <span class="text-white/90">Welcome, {{ user.username }}!</span>
            {% if user|is_admin %}
              <a href="{% url 'admin:index' %}" 
                 class="px-4 py-2 bg-pyc-orange text-white rounded-lg hover:bg-opacity-90 transition-colors">
                Admin
              </a>
            {% endif %}
            <a href="{% url 'logout' %}" 
               class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
              Logout
            </a>
          {% else %}
            <a href="{% url 'login' %}" 
               class="px-4 py-2 bg-pyc-green text-white rounded-lg hover:bg-opacity-90 transition-colors">
              Login
            </a>
          {% endif %}
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div id="mobile-menu" class="hidden lg:hidden pb-4">
        <div class="flex flex-col space-y-3">
          <a href="https://pychoir.parklandssda.org/" target="_blank" 
             class="text-white hover:text-pyc-orange transition-colors">About PYC</a>
          <a href="{% url 'song_list' %}" 
             class="text-white hover:text-pyc-orange transition-colors">Songs</a>
          <a href="{% url 'add_song' %}" 
             class="text-white hover:text-pyc-orange transition-colors">Add Song</a>
          <a href="#" 
             class="text-white hover:text-pyc-orange transition-colors">References</a>
          
          {% if user.is_authenticated %}
            <span class="text-white/90 text-sm">Welcome, {{ user.username }}!</span>
            {% if user|is_admin %}
              <a href="{% url 'admin:index' %}" 
                 class="px-4 py-2 bg-pyc-orange text-white rounded-lg hover:bg-opacity-90 transition-colors text-center">
                Admin
              </a>
            {% endif %}
            <a href="{% url 'logout' %}" 
               class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-center">
              Logout
            </a>
          {% else %}
            <a href="{% url 'login' %}" 
               class="px-4 py-2 bg-pyc-green text-white rounded-lg hover:bg-opacity-90 transition-colors text-center">
              Login
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="flex-grow container mx-auto px-4 py-6">
    {% if messages %}
    <div class="mb-4 space-y-2">
      {% for message in messages %}
      <div class="bg-pyc-green/10 border-l-4 border-pyc-green text-pyc-text px-4 py-3 rounded shadow-sm alert-message">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        setTimeout(function () {
          $(".alert-message").fadeOut("slow");
        }, 2000);
      });
    </script>

    {% block content %}
    {% endblock %}

    {% block player %}
    {% endblock %}
  </div>

  <!-- Footer (Optional) -->
  <!-- <footer class="bg-gray-100 text-pyc-text text-center py-4 mt-auto">
    <p class="text-sm">&copy; 2025 PYC WarmUp. All rights reserved.</p>
  </footer> -->

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("/serviceworker.js")
        .then(function (registration) {
          console.log("Service Worker registered with scope:", registration.scope);
        })
        .catch(function (error) {
          console.log("Service Worker registration failed:", error);
        });
    }
  </script>

  {% block extra_js %}
  {% endblock %}
</body>

</html>